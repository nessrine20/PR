<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TP - VPN IPSec Site-√†-Site</title>
<style>
  body { font-family: Arial; margin: 0; background: #f4eaff; line-height: 1.8; }
  .topbar { background: linear-gradient(135deg, #c59bff, #b07cff); padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; color: white; position: sticky; top: 0; }
  .topbar-title { font-size: 20px; font-weight: bold; }
  .back-btn { padding: 8px 16px; background: #fff; color: #6a34cc; border-radius: 8px; font-weight: bold; text-decoration: none; }
  .container { width: 70%; margin: 40px auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); }
  h1 { color: #4a2db6; border-bottom: 3px solid #e9d6ff; padding-bottom: 15px; }
  h2 { color: #5b22b3; margin-top: 30px; }
  .objective { background: #e8f4ff; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #007bff; }
  .step { background: #f8f4ff; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #6a34cc; }
  .step-num { background: #6a34cc; color: white; padding: 5px 12px; border-radius: 50%; font-weight: bold; margin-right: 10px; }
  .code-block { background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 8px; font-family: monospace; margin: 15px 0; overflow-x: auto; font-size: 12px; }
  .success { background: #d4edda; padding: 20px; border-radius: 10px; margin: 20px 0; }
  .tip { background: #fff3cd; padding: 15px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #ffc107; }
</style>
</head>
<body>
<div class="topbar">
  <div class="topbar-title">üîß TP - VPN IPSec</div>
  <a href="../vpn.html" class="back-btn">‚Üê Retour au cours</a>
</div>
<div class="container">
  <h1>üîê TP : VPN IPSec Site-√†-Site avec StrongSwan</h1>

  <div class="objective">
    <strong>üéØ Objectifs :</strong>
    <ul>
      <li>Installer StrongSwan</li>
      <li>Configurer un VPN IPSec site-√†-site</li>
      <li>Tester la connectivit√©</li>
      <li>Analyser le trafic chiffr√©</li>
    </ul>
    <strong>‚è±Ô∏è Dur√©e :</strong> 2h<br>
    <strong>üõ†Ô∏è Pr√©requis :</strong> 2 VMs Linux (Ubuntu/Debian)
  </div>

  <div class="tip">
    <strong>üí° Topologie :</strong><br>
    Site A (192.168.1.0/24) ‚Üê Internet ‚Üí Site B (192.168.2.0/24)
  </div>

  <h2>Partie 1 : Installation</h2>

  <div class="step">
    <p><span class="step-num">1</span><strong>Installer StrongSwan (sur les 2 machines)</strong></p>
    <div class="code-block">sudo apt update
sudo apt install strongswan strongswan-pki libcharon-extra-plugins -y</div>
  </div>

  <div class="step">
    <p><span class="step-num">2</span><strong>Activer l'IP forwarding</strong></p>
    <div class="code-block">echo "net.ipv4.ip_forward=1" | sudo tee -a /etc/sysctl.conf
sudo sysctl -p</div>
  </div>

  <h2>Partie 2 : Configuration Site A</h2>

  <div class="step">
    <p><span class="step-num">3</span><strong>Configurer /etc/ipsec.conf (Site A)</strong></p>
    <div class="code-block">config setup
    charondebug="ike 2, knl 2, cfg 2"

conn site-to-site
    type=tunnel
    auto=start
    keyexchange=ikev2
    authby=secret
    
    # Site A (local)
    left=203.0.113.1
    leftsubnet=192.168.1.0/24
    leftid=@siteA
    
    # Site B (remote)
    right=198.51.100.1
    rightsubnet=192.168.2.0/24
    rightid=@siteB
    
    # Crypto
    ike=aes256-sha256-modp2048!
    esp=aes256-sha256!
    
    ikelifetime=24h
    lifetime=1h
    dpdaction=restart
    dpddelay=30s</div>
  </div>

  <div class="step">
    <p><span class="step-num">4</span><strong>Configurer le secret partag√© (Site A)</strong></p>
    <div class="code-block"># /etc/ipsec.secrets
@siteA @siteB : PSK "MotDePasseTresTresSecurise2024!"</div>
  </div>

  <h2>Partie 3 : Configuration Site B</h2>

  <div class="step">
    <p><span class="step-num">5</span><strong>Configurer /etc/ipsec.conf (Site B)</strong></p>
    <div class="code-block">config setup
    charondebug="ike 2, knl 2, cfg 2"

conn site-to-site
    type=tunnel
    auto=start
    keyexchange=ikev2
    authby=secret
    
    # Site B (local)
    left=198.51.100.1
    leftsubnet=192.168.2.0/24
    leftid=@siteB
    
    # Site A (remote)
    right=203.0.113.1
    rightsubnet=192.168.1.0/24
    rightid=@siteA
    
    # Crypto (identique)
    ike=aes256-sha256-modp2048!
    esp=aes256-sha256!
    
    ikelifetime=24h
    lifetime=1h
    dpdaction=restart
    dpddelay=30s</div>
  </div>

  <div class="step">
    <p><span class="step-num">6</span><strong>Configurer le secret (Site B)</strong></p>
    <div class="code-block"># /etc/ipsec.secrets
@siteB @siteA : PSK "MotDePasseTresTresSecurise2024!"</div>
  </div>

  <h2>Partie 4 : D√©marrage et test</h2>

  <div class="step">
    <p><span class="step-num">7</span><strong>D√©marrer IPSec</strong></p>
    <div class="code-block"># Sur les deux sites
sudo ipsec restart
sudo ipsec up site-to-site

# V√©rifier le statut
sudo ipsec status
sudo ipsec statusall</div>
  </div>

  <div class="step">
    <p><span class="step-num">8</span><strong>Tester la connectivit√©</strong></p>
    <div class="code-block"># Depuis Site A, ping une machine de Site B
ping 192.168.2.10

# V√©rifier les routes
ip route

# V√©rifier les SA
sudo ip xfrm state
sudo ip xfrm policy</div>
  </div>

  <h2>Partie 5 : Analyse</h2>

  <div class="step">
    <p><span class="step-num">9</span><strong>Capturer le trafic ESP</strong></p>
    <div class="code-block"># Capturer les paquets ESP
sudo tcpdump -i eth0 esp -w ipsec_capture.pcap

# Analyser avec Wireshark
# Les donn√©es sont chiffr√©es (ESP)</div>
  </div>

  <div class="step">
    <p><span class="step-num">10</span><strong>V√©rifier les logs</strong></p>
    <div class="code-block">sudo tail -f /var/log/syslog | grep charon

# Ou journal systemd
sudo journalctl -u strongswan -f</div>
  </div>

  <div class="success">
    <strong>‚úÖ Livrables :</strong>
    <ol>
      <li>Fichiers de configuration des deux sites</li>
      <li>Capture d'√©cran du tunnel √©tabli (ipsec status)</li>
      <li>Ping r√©ussi entre les deux r√©seaux</li>
      <li>Capture Wireshark montrant les paquets ESP</li>
    </ol>
  </div>
</div>
</body>
</html>


